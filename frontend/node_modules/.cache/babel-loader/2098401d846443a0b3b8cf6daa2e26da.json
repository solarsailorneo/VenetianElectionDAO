{"ast":null,"code":"var _jsxFileName = \"/home/siquike/projectsNode/04_15_22/moralis-poll/frontend/src/components/Polls.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect, useRef } from \"react\";\nimport { useMoralis, useNativeBalance, useNewMoralisObject } from \"react-moralis\";\nimport Poll from \"react-polls\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nlet saved_account = \"\"; // WARNING: DEMO CODE/WIP\n// TODO: Need to display/build Polls data from Moralis instance.\n// TODO: utilise further  calls such as â€¦\n// 'const { switchNetwork, chainId, chain, account } = useChain();'\n// Declaring poll question and answers\n// Currenltly static, exisiting example of objectId in Moralis instance's db.\n\nconst pollQuestion = \"Who should be Doge ?\";\nconst answers = [{\n  option: \"Yes\",\n  votes: 7\n}, {\n  option: \"No\",\n  votes: 2\n}, {\n  option: \"don't know\",\n  votes: 1\n}];\nlet option_voted = \"\";\nlet poll_id = 1;\nlet voter = {};\nlet poll_title = \"\";\nlet poll_options = [];\n\nfunction Polls(_ref) {\n  _s();\n\n  let {\n    more\n  } = _ref;\n  const [access, setReg] = useState(false);\n  const [initialState, setInitialState] = useState(0);\n  const {\n    isInitialized,\n    account,\n    isAuthenticated,\n    Moralis\n  } = useMoralis();\n  const [validatedWallet, setValidatedWallet] = useState(false);\n  const [answers, setAnswers] = useState([]);\n  const [randomSelection, setRandomSelection] = useState(true);\n  const {\n    getBalance,\n    data: balance,\n    nativeToken,\n    isLoading\n  } = useNativeBalance({\n    chain: \"rinkeby\"\n  });\n  const {\n    isSaving,\n    error,\n    save,\n    object\n  } = useNewMoralisObject(\"Polls\"); // Setting answers to state to reload the component with each vote\n\n  const [pollAnswers, setPollAnswers] = useState([...answers]);\n  const isInitialMount = useRef(true);\n\n  const updatePoll = async () => {\n    const PollData = Moralis.Object.extend(\"Polls\");\n    const query = new Moralis.Query(PollData); // Building Poll from Moralis instance will include: 'query.equalTo(\"id\", 1);'\n\n    query.equalTo(\"pollId\", 1); //<-- temp/static id to update same row, instead of saving new row\n\n    const poll = await query.first();\n    return poll;\n  }; // check reg status -> handle\n\n\n  const checkReg = async _access => {\n    if (!isAuthenticated) {\n      // not authenticated user\n      return false;\n    } else {\n      // access condition\n      _access = balance.balance && balance.balance > 0 ? true : false;\n\n      if (_access) {\n        // reset/build options\n        option_voted = \"\";\n        voter = account;\n        poll_title = pollQuestion;\n        poll_options = answers;\n        setPollAnswers(poll_options); // give access to vote if meets conditions\n\n        setReg(_access);\n        saved_account = account;\n      } else {// no access\n      }\n\n      return _access;\n    }\n  };\n\n  useEffect(() => {\n    const submitWallet = async () => {\n      const address = {\n        address: account\n      };\n      console.log(JSON.stringify(address));\n      const result = await fetch('/api/', {\n        method: 'POST',\n        headers: {\n          'content-Type': 'application/json'\n        },\n        body: JSON.stringify(address),\n        mode: \"cors\"\n      });\n      const resultInJson = await result.json();\n      console.log(resultInJson);\n\n      if (resultInJson.confirmation) {\n        const electees = await fetch('/api/electees/');\n        const electeesInJson = await electees.json();\n        console.log(electeesInJson.electee_pool);\n        console.log(answers);\n        setAnswers(electeesInJson.electee_pool);\n        setRandomSelection(electeesInJson.random_selection);\n      }\n    };\n\n    const getElectionResult = async () => {\n      const electionResult = await fetch('/api/');\n      const electionResultInJson = await electionResult.json();\n      console.log(electionResultInJson);\n    };\n\n    submitWallet();\n    getElectionResult();\n  }, []);\n  useEffect(() => {\n    if (isInitialMount.current) {\n      isInitialMount.current = false;\n    } else {\n      // run on update\n      if (isInitialized && balance.balance > 0) {\n        if (saved_account !== account) {\n          // check registration status\n          checkReg();\n        }\n      } else {\n        // reset registration status to false\n        setReg(false);\n      }\n    }\n  }, [account, balance, isInitialized]);\n\n  const handleVote = async voteAnswer => {\n    option_voted = voteAnswer;\n    const asyncVoteRes = await Promise.all(pollAnswers.map(async answer => {\n      if (answer.option === option_voted) {\n        answer.votes = answer.votes + 1;\n      }\n\n      return answer;\n    }));\n    console.log(\"Async\", asyncVoteRes);\n    poll_options = asyncVoteRes; // Poll Class Design\n    // columns: poll_id: uint, poll_options: [{option: \"Yes\", votes: 7}, {option: \"No\", votes: 2}], poll_voters: {user_id}\n    // test db integration with static example\n    // create poll\n    //\n\n    let poll_data = {\n      id: poll_id,\n      title: poll_title,\n      options: poll_options,\n      voted: voter\n    };\n    const pollObject = new Moralis.Object(\"Polls\");\n    pollObject.set(\"id\", poll_data.id);\n    pollObject.set(\"title\", poll_data.title);\n    pollObject.set(\"options\", poll_data.options);\n    pollObject.addUnique(\"voted\", poll_data.voted);\n    pollObject.save();\n  };\n\n  const handleContinue = async () => {\n    const continueElection = {\n      address: true\n    };\n    console.log(JSON.stringify(continueElection));\n    const result = await fetch('/api/continue/', {\n      method: 'POST',\n      headers: {\n        'content-Type': 'application/json'\n      },\n      body: JSON.stringify(address),\n      mode: \"cors\"\n    });\n    const resultInJson = await result.json();\n    console.log(resultInJson);\n\n    if (resultInJson.confirmation) {\n      const electees = await fetch('/api/electees/');\n      const electeesInJson = await electees.json();\n      console.log(electeesInJson.electee_pool);\n      console.log(answers);\n      setAnswers(electeesInJson.electee_pool);\n      setRandomSelection(electeesInJson.random_selection);\n    }\n  }; // Not authoriased\n\n\n  if (!access) {\n    return /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: \"NO ACCESS\"\n    }, void 0, false);\n  }\n\n  if (randomSelection) {\n    return /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [/*#__PURE__*/_jsxDEV(Poll, {\n        question: pollQuestion,\n        answers: pollAnswers,\n        noStorage: true\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 229,\n        columnNumber: 7\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onclick: handleContinue,\n        children: \"Continue\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 234,\n        columnNumber: 7\n      }, this)]\n    }, void 0, true);\n  } else {\n    // Authoriased\n    return /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: /*#__PURE__*/_jsxDEV(Poll, {\n        question: pollQuestion,\n        answers: pollAnswers,\n        onVote: handleVote,\n        noStorage: true\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 246,\n        columnNumber: 9\n      }, this)\n    }, void 0, false);\n  }\n}\n\n_s(Polls, \"w49EDEGuaT2wOPbvZSBjYnr/VMA=\", false, function () {\n  return [useMoralis, useNativeBalance, useNewMoralisObject];\n});\n\n_c = Polls;\nexport default Polls;\n\nvar _c;\n\n$RefreshReg$(_c, \"Polls\");","map":{"version":3,"sources":["/home/siquike/projectsNode/04_15_22/moralis-poll/frontend/src/components/Polls.js"],"names":["React","useState","useEffect","useRef","useMoralis","useNativeBalance","useNewMoralisObject","Poll","saved_account","pollQuestion","answers","option","votes","option_voted","poll_id","voter","poll_title","poll_options","Polls","more","access","setReg","initialState","setInitialState","isInitialized","account","isAuthenticated","Moralis","validatedWallet","setValidatedWallet","setAnswers","randomSelection","setRandomSelection","getBalance","data","balance","nativeToken","isLoading","chain","isSaving","error","save","object","pollAnswers","setPollAnswers","isInitialMount","updatePoll","PollData","Object","extend","query","Query","equalTo","poll","first","checkReg","_access","submitWallet","address","console","log","JSON","stringify","result","fetch","method","headers","body","mode","resultInJson","json","confirmation","electees","electeesInJson","electee_pool","random_selection","getElectionResult","electionResult","electionResultInJson","current","handleVote","voteAnswer","asyncVoteRes","Promise","all","map","answer","poll_data","id","title","options","voted","pollObject","set","addUnique","handleContinue","continueElection"],"mappings":";;;AAAA,OAAOA,KAAP,IAAgBC,QAAhB,EAA0BC,SAA1B,EAAqCC,MAArC,QAAmD,OAAnD;AACA,SACEC,UADF,EAEEC,gBAFF,EAGEC,mBAHF,QAIO,eAJP;AAKA,OAAOC,IAAP,MAAiB,aAAjB;;;AAEA,IAAIC,aAAa,GAAG,EAApB,C,CAEA;AACA;AACA;AACA;AAEA;AACA;;AAEA,MAAMC,YAAY,GAAG,sBAArB;AACA,MAAMC,OAAO,GAAG,CACd;AAAEC,EAAAA,MAAM,EAAE,KAAV;AAAiBC,EAAAA,KAAK,EAAE;AAAxB,CADc,EAEd;AAAED,EAAAA,MAAM,EAAE,IAAV;AAAgBC,EAAAA,KAAK,EAAE;AAAvB,CAFc,EAGd;AAAED,EAAAA,MAAM,EAAE,YAAV;AAAwBC,EAAAA,KAAK,EAAE;AAA/B,CAHc,CAAhB;AAKA,IAAIC,YAAY,GAAG,EAAnB;AACA,IAAIC,OAAO,GAAG,CAAd;AACA,IAAIC,KAAK,GAAG,EAAZ;AACA,IAAIC,UAAU,GAAG,EAAjB;AACA,IAAIC,YAAY,GAAG,EAAnB;;AAEA,SAASC,KAAT,OAAyB;AAAA;;AAAA,MAAV;AAAEC,IAAAA;AAAF,GAAU;AACvB,QAAM,CAACC,MAAD,EAASC,MAAT,IAAmBpB,QAAQ,CAAC,KAAD,CAAjC;AACA,QAAM,CAACqB,YAAD,EAAeC,eAAf,IAAkCtB,QAAQ,CAAC,CAAD,CAAhD;AACA,QAAM;AAAEuB,IAAAA,aAAF;AAAiBC,IAAAA,OAAjB;AAA0BC,IAAAA,eAA1B;AAA2CC,IAAAA;AAA3C,MAAuDvB,UAAU,EAAvE;AACA,QAAM,CAACwB,eAAD,EAAkBC,kBAAlB,IAAwC5B,QAAQ,CAAC,KAAD,CAAtD;AACA,QAAM,CAACS,OAAD,EAAUoB,UAAV,IAAwB7B,QAAQ,CAAC,EAAD,CAAtC;AACA,QAAM,CAAC8B,eAAD,EAAkBC,kBAAlB,IAAwC/B,QAAQ,CAAC,IAAD,CAAtD;AAEA,QAAM;AACJgC,IAAAA,UADI;AAEJC,IAAAA,IAAI,EAAEC,OAFF;AAGJC,IAAAA,WAHI;AAIJC,IAAAA;AAJI,MAKFhC,gBAAgB,CAAC;AAAEiC,IAAAA,KAAK,EAAE;AAAT,GAAD,CALpB;AAMA,QAAM;AAAEC,IAAAA,QAAF;AAAYC,IAAAA,KAAZ;AAAmBC,IAAAA,IAAnB;AAAyBC,IAAAA;AAAzB,MAAoCpC,mBAAmB,CAAC,OAAD,CAA7D,CAduB,CAgBvB;;AACA,QAAM,CAACqC,WAAD,EAAcC,cAAd,IAAgC3C,QAAQ,CAAC,CAAC,GAAGS,OAAJ,CAAD,CAA9C;AACA,QAAMmC,cAAc,GAAG1C,MAAM,CAAC,IAAD,CAA7B;;AAEA,QAAM2C,UAAU,GAAG,YAAY;AAC7B,UAAMC,QAAQ,GAAGpB,OAAO,CAACqB,MAAR,CAAeC,MAAf,CAAsB,OAAtB,CAAjB;AACA,UAAMC,KAAK,GAAG,IAAIvB,OAAO,CAACwB,KAAZ,CAAkBJ,QAAlB,CAAd,CAF6B,CAG7B;;AACAG,IAAAA,KAAK,CAACE,OAAN,CAAc,QAAd,EAAwB,CAAxB,EAJ6B,CAID;;AAC5B,UAAMC,IAAI,GAAG,MAAMH,KAAK,CAACI,KAAN,EAAnB;AAEA,WAAOD,IAAP;AACD,GARD,CApBuB,CA8BvB;;;AACA,QAAME,QAAQ,GAAG,MAAOC,OAAP,IAAmB;AAClC,QAAI,CAAC9B,eAAL,EAAsB;AACpB;AACA,aAAO,KAAP;AACD,KAHD,MAGO;AACL;AACA8B,MAAAA,OAAO,GAAGrB,OAAO,CAACA,OAAR,IAAmBA,OAAO,CAACA,OAAR,GAAkB,CAArC,GAAyC,IAAzC,GAAgD,KAA1D;;AACA,UAAIqB,OAAJ,EAAa;AACX;AACA3C,QAAAA,YAAY,GAAG,EAAf;AACAE,QAAAA,KAAK,GAAGU,OAAR;AACAT,QAAAA,UAAU,GAAGP,YAAb;AACAQ,QAAAA,YAAY,GAAGP,OAAf;AACAkC,QAAAA,cAAc,CAAC3B,YAAD,CAAd,CANW,CAOX;;AACAI,QAAAA,MAAM,CAACmC,OAAD,CAAN;AACAhD,QAAAA,aAAa,GAAGiB,OAAhB;AACD,OAVD,MAUO,CACL;AACD;;AAED,aAAO+B,OAAP;AACD;AACF,GAvBD;;AAyBAtD,EAAAA,SAAS,CAAC,MAAM;AAEd,UAAMuD,YAAY,GAAG,YAAY;AAC/B,YAAMC,OAAO,GAAG;AACdA,QAAAA,OAAO,EAAEjC;AADK,OAAhB;AAGAkC,MAAAA,OAAO,CAACC,GAAR,CAAYC,IAAI,CAACC,SAAL,CAAeJ,OAAf,CAAZ;AACA,YAAMK,MAAM,GAAG,MAAMC,KAAK,CAAC,OAAD,EAAU;AAClCC,QAAAA,MAAM,EAAE,MAD0B;AAElCC,QAAAA,OAAO,EAAE;AACP,0BAAgB;AADT,SAFyB;AAKlCC,QAAAA,IAAI,EAAEN,IAAI,CAACC,SAAL,CAAeJ,OAAf,CAL4B;AAMlCU,QAAAA,IAAI,EAAE;AAN4B,OAAV,CAA1B;AASA,YAAMC,YAAY,GAAG,MAAMN,MAAM,CAACO,IAAP,EAA3B;AACAX,MAAAA,OAAO,CAACC,GAAR,CAAYS,YAAZ;;AAEA,UAAGA,YAAY,CAACE,YAAhB,EACA;AACA,cAAMC,QAAQ,GAAG,MAAMR,KAAK,CAAC,gBAAD,CAA5B;AACA,cAAMS,cAAc,GAAG,MAAMD,QAAQ,CAACF,IAAT,EAA7B;AACAX,QAAAA,OAAO,CAACC,GAAR,CAAYa,cAAc,CAACC,YAA3B;AACAf,QAAAA,OAAO,CAACC,GAAR,CAAYlD,OAAZ;AACAoB,QAAAA,UAAU,CAAC2C,cAAc,CAACC,YAAhB,CAAV;AACA1C,QAAAA,kBAAkB,CAACyC,cAAc,CAACE,gBAAhB,CAAlB;AAEC;AAGF,KA7BD;;AAgCA,UAAMC,iBAAiB,GAAG,YAAY;AACpC,YAAMC,cAAc,GAAG,MAAMb,KAAK,CAAC,OAAD,CAAlC;AACA,YAAMc,oBAAoB,GAAG,MAAMD,cAAc,CAACP,IAAf,EAAnC;AAEAX,MAAAA,OAAO,CAACC,GAAR,CAAYkB,oBAAZ;AACD,KALD;;AAOArB,IAAAA,YAAY;AAEZmB,IAAAA,iBAAiB;AAElB,GA7CQ,EA6CP,EA7CO,CAAT;AA+CA1E,EAAAA,SAAS,CAAC,MAAM;AACd,QAAI2C,cAAc,CAACkC,OAAnB,EAA4B;AAC1BlC,MAAAA,cAAc,CAACkC,OAAf,GAAyB,KAAzB;AACD,KAFD,MAEO;AACL;AACA,UAAIvD,aAAa,IAAIW,OAAO,CAACA,OAAR,GAAkB,CAAvC,EAA0C;AACxC,YAAI3B,aAAa,KAAKiB,OAAtB,EAA+B;AAC7B;AACA8B,UAAAA,QAAQ;AACT;AACF,OALD,MAKO;AACL;AACAlC,QAAAA,MAAM,CAAC,KAAD,CAAN;AACD;AACF;AACF,GAfQ,EAeN,CAACI,OAAD,EAAUU,OAAV,EAAmBX,aAAnB,CAfM,CAAT;;AAiBA,QAAMwD,UAAU,GAAG,MAAOC,UAAP,IAAsB;AACvCpE,IAAAA,YAAY,GAAGoE,UAAf;AAEA,UAAMC,YAAY,GAAG,MAAMC,OAAO,CAACC,GAAR,CACzBzC,WAAW,CAAC0C,GAAZ,CAAgB,MAAOC,MAAP,IAAkB;AAChC,UAAIA,MAAM,CAAC3E,MAAP,KAAkBE,YAAtB,EAAoC;AAClCyE,QAAAA,MAAM,CAAC1E,KAAP,GAAe0E,MAAM,CAAC1E,KAAP,GAAe,CAA9B;AACD;;AACD,aAAO0E,MAAP;AACD,KALD,CADyB,CAA3B;AASA3B,IAAAA,OAAO,CAACC,GAAR,CAAY,OAAZ,EAAqBsB,YAArB;AACAjE,IAAAA,YAAY,GAAGiE,YAAf,CAbuC,CAevC;AACA;AAEA;AACA;AACA;;AACA,QAAIK,SAAS,GAAG;AACdC,MAAAA,EAAE,EAAE1E,OADU;AAEd2E,MAAAA,KAAK,EAAEzE,UAFO;AAGd0E,MAAAA,OAAO,EAAEzE,YAHK;AAId0E,MAAAA,KAAK,EAAE5E;AAJO,KAAhB;AAOA,UAAM6E,UAAU,GAAG,IAAIjE,OAAO,CAACqB,MAAZ,CAAmB,OAAnB,CAAnB;AACA4C,IAAAA,UAAU,CAACC,GAAX,CAAe,IAAf,EAAqBN,SAAS,CAACC,EAA/B;AACAI,IAAAA,UAAU,CAACC,GAAX,CAAe,OAAf,EAAwBN,SAAS,CAACE,KAAlC;AACAG,IAAAA,UAAU,CAACC,GAAX,CAAe,SAAf,EAA0BN,SAAS,CAACG,OAApC;AACAE,IAAAA,UAAU,CAACE,SAAX,CAAqB,OAArB,EAA8BP,SAAS,CAACI,KAAxC;AACAC,IAAAA,UAAU,CAACnD,IAAX;AACD,GAlCD;;AAoCA,QAAMsD,cAAc,GAAG,YAAY;AACjC,UAAMC,gBAAgB,GAAG;AACvBtC,MAAAA,OAAO,EAAE;AADc,KAAzB;AAGAC,IAAAA,OAAO,CAACC,GAAR,CAAYC,IAAI,CAACC,SAAL,CAAekC,gBAAf,CAAZ;AACA,UAAMjC,MAAM,GAAG,MAAMC,KAAK,CAAC,gBAAD,EAAmB;AAC3CC,MAAAA,MAAM,EAAE,MADmC;AAE3CC,MAAAA,OAAO,EAAE;AACP,wBAAgB;AADT,OAFkC;AAK3CC,MAAAA,IAAI,EAAEN,IAAI,CAACC,SAAL,CAAeJ,OAAf,CALqC;AAM3CU,MAAAA,IAAI,EAAE;AANqC,KAAnB,CAA1B;AASA,UAAMC,YAAY,GAAG,MAAMN,MAAM,CAACO,IAAP,EAA3B;AACAX,IAAAA,OAAO,CAACC,GAAR,CAAYS,YAAZ;;AAEA,QAAGA,YAAY,CAACE,YAAhB,EACA;AACA,YAAMC,QAAQ,GAAG,MAAMR,KAAK,CAAC,gBAAD,CAA5B;AACA,YAAMS,cAAc,GAAG,MAAMD,QAAQ,CAACF,IAAT,EAA7B;AACAX,MAAAA,OAAO,CAACC,GAAR,CAAYa,cAAc,CAACC,YAA3B;AACAf,MAAAA,OAAO,CAACC,GAAR,CAAYlD,OAAZ;AACAoB,MAAAA,UAAU,CAAC2C,cAAc,CAACC,YAAhB,CAAV;AACA1C,MAAAA,kBAAkB,CAACyC,cAAc,CAACE,gBAAhB,CAAlB;AAEC;AAEF,GA5BD,CA5JuB,CA6LvB;;;AACA,MAAI,CAACvD,MAAL,EAAa;AACX,wBAAO;AAAA,gBAAG;AAAH,qBAAP;AACD;;AAED,MAAGW,eAAH,EACA;AACE,wBACE;AAAA,8BACA,QAAC,IAAD;AACE,QAAA,QAAQ,EAAEtB,YADZ;AAEE,QAAA,OAAO,EAAEkC,WAFX;AAGE,QAAA,SAAS;AAHX;AAAA;AAAA;AAAA;AAAA,cADA,eAMA;AACE,QAAA,OAAO,EAAEoD,cADX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cANA;AAAA,oBADF;AAaD,GAfD,MAiBA;AACE;AACA,wBACE;AAAA,6BACE,QAAC,IAAD;AACE,QAAA,QAAQ,EAAEtF,YADZ;AAEE,QAAA,OAAO,EAAEkC,WAFX;AAGE,QAAA,MAAM,EAAEqC,UAHV;AAIE,QAAA,SAAS;AAJX;AAAA;AAAA;AAAA;AAAA;AADF,qBADF;AAUD;AAIF;;GAnOQ9D,K;UAGsDd,U,EAUzDC,gB,EACsCC,mB;;;KAdnCY,K;AAqOT,eAAeA,KAAf","sourcesContent":["import React, { useState, useEffect, useRef } from \"react\";\nimport {\n  useMoralis,\n  useNativeBalance,\n  useNewMoralisObject,\n} from \"react-moralis\";\nimport Poll from \"react-polls\";\n\nlet saved_account = \"\";\n\n// WARNING: DEMO CODE/WIP\n// TODO: Need to display/build Polls data from Moralis instance.\n// TODO: utilise further  calls such as â€¦\n// 'const { switchNetwork, chainId, chain, account } = useChain();'\n\n// Declaring poll question and answers\n// Currenltly static, exisiting example of objectId in Moralis instance's db.\n\nconst pollQuestion = \"Who should be Doge ?\";\nconst answers = [\n  { option: \"Yes\", votes: 7 },\n  { option: \"No\", votes: 2 },\n  { option: \"don't know\", votes: 1 },\n];\nlet option_voted = \"\";\nlet poll_id = 1;\nlet voter = {};\nlet poll_title = \"\";\nlet poll_options = [];\n\nfunction Polls({ more }) {\n  const [access, setReg] = useState(false);\n  const [initialState, setInitialState] = useState(0);\n  const { isInitialized, account, isAuthenticated, Moralis } = useMoralis();\n  const [validatedWallet, setValidatedWallet] = useState(false);\n  const [answers, setAnswers] = useState([]);\n  const [randomSelection, setRandomSelection] = useState(true);\n\n  const {\n    getBalance,\n    data: balance,\n    nativeToken,\n    isLoading,\n  } = useNativeBalance({ chain: \"rinkeby\" });\n  const { isSaving, error, save, object } = useNewMoralisObject(\"Polls\");\n\n  // Setting answers to state to reload the component with each vote\n  const [pollAnswers, setPollAnswers] = useState([...answers]);\n  const isInitialMount = useRef(true);\n\n  const updatePoll = async () => {\n    const PollData = Moralis.Object.extend(\"Polls\");\n    const query = new Moralis.Query(PollData);\n    // Building Poll from Moralis instance will include: 'query.equalTo(\"id\", 1);'\n    query.equalTo(\"pollId\", 1); //<-- temp/static id to update same row, instead of saving new row\n    const poll = await query.first();\n\n    return poll;\n  };\n\n  // check reg status -> handle\n  const checkReg = async (_access) => {\n    if (!isAuthenticated) {\n      // not authenticated user\n      return false;\n    } else {\n      // access condition\n      _access = balance.balance && balance.balance > 0 ? true : false;\n      if (_access) {\n        // reset/build options\n        option_voted = \"\";\n        voter = account;\n        poll_title = pollQuestion;\n        poll_options = answers;\n        setPollAnswers(poll_options);\n        // give access to vote if meets conditions\n        setReg(_access);\n        saved_account = account;\n      } else {\n        // no access\n      }\n\n      return _access;\n    }\n  };\n\n  useEffect(() => {\n\n    const submitWallet = async () => {\n      const address = {\n        address: account\n      }\n      console.log(JSON.stringify(address));\n      const result = await fetch('/api/', {\n        method: 'POST',\n        headers: {\n          'content-Type': 'application/json'\n        },\n        body: JSON.stringify(address), \n        mode: \"cors\"\n      })\n  \n      const resultInJson = await result.json();\n      console.log(resultInJson);\n\n      if(resultInJson.confirmation)\n      {\n      const electees = await fetch('/api/electees/');\n      const electeesInJson = await electees.json();\n      console.log(electeesInJson.electee_pool)\n      console.log(answers)\n      setAnswers(electeesInJson.electee_pool);\n      setRandomSelection(electeesInJson.random_selection);\n\n      }\n\n\n    }\n\n\n    const getElectionResult = async () => {\n      const electionResult = await fetch('/api/');\n      const electionResultInJson = await electionResult.json();\n\n      console.log(electionResultInJson)\n    }\n\n    submitWallet();\n\n    getElectionResult();\n    \n  },[]);\n\n  useEffect(() => {\n    if (isInitialMount.current) {\n      isInitialMount.current = false;\n    } else {\n      // run on update\n      if (isInitialized && balance.balance > 0) {\n        if (saved_account !== account) {\n          // check registration status\n          checkReg();\n        }\n      } else {\n        // reset registration status to false\n        setReg(false);\n      }\n    }\n  }, [account, balance, isInitialized]);\n\n  const handleVote = async (voteAnswer) => {\n    option_voted = voteAnswer;\n\n    const asyncVoteRes = await Promise.all(\n      pollAnswers.map(async (answer) => {\n        if (answer.option === option_voted) {\n          answer.votes = answer.votes + 1;\n        }\n        return answer;\n      })\n    );\n\n    console.log(\"Async\", asyncVoteRes);\n    poll_options = asyncVoteRes;\n\n    // Poll Class Design\n    // columns: poll_id: uint, poll_options: [{option: \"Yes\", votes: 7}, {option: \"No\", votes: 2}], poll_voters: {user_id}\n\n    // test db integration with static example\n    // create poll\n    //\n    let poll_data = {\n      id: poll_id,\n      title: poll_title,\n      options: poll_options,\n      voted: voter,\n    };\n\n    const pollObject = new Moralis.Object(\"Polls\");\n    pollObject.set(\"id\", poll_data.id);\n    pollObject.set(\"title\", poll_data.title);\n    pollObject.set(\"options\", poll_data.options);\n    pollObject.addUnique(\"voted\", poll_data.voted);\n    pollObject.save();\n  };\n\n  const handleContinue = async () => {\n    const continueElection = {\n      address: true\n    }\n    console.log(JSON.stringify(continueElection));\n    const result = await fetch('/api/continue/', {\n      method: 'POST',\n      headers: {\n        'content-Type': 'application/json'\n      },\n      body: JSON.stringify(address), \n      mode: \"cors\"\n    })\n\n    const resultInJson = await result.json();\n    console.log(resultInJson);\n\n    if(resultInJson.confirmation)\n    {\n    const electees = await fetch('/api/electees/');\n    const electeesInJson = await electees.json();\n    console.log(electeesInJson.electee_pool)\n    console.log(answers)\n    setAnswers(electeesInJson.electee_pool);\n    setRandomSelection(electeesInJson.random_selection);\n\n    }\n\n  };\n\n\n\n\n  // Not authoriased\n  if (!access) {\n    return <>{\"NO ACCESS\"}</>;\n  }\n\n  if(randomSelection)\n  {\n    return (\n      <>\n      <Poll\n        question={pollQuestion}\n        answers={pollAnswers}\n        noStorage\n      />\n      <button \n        onclick={handleContinue}>\n        Continue\n      </button>\n    </>\n    );\n  }\n  else\n  {\n    // Authoriased\n    return (\n      <>\n        <Poll\n          question={pollQuestion}\n          answers={pollAnswers}\n          onVote={handleVote}\n          noStorage\n        />\n      </>\n    );\n  }\n  \n\n  \n}\n\nexport default Polls;\n"]},"metadata":{},"sourceType":"module"}